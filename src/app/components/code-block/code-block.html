
<!-- Versión simplificada y segura -->
<div class="code-block-wrapper" [ngClass]="styles().wrapperClasses">
  
  <!-- Header (siempre que haya filename o no sea minimal) -->
  @if (shouldShowHeader() && (filename() || variant() !== 'minimal')) {
    <div class="code-header px-4 py-3 flex items-center justify-between gap-4"
         [ngClass]="styles().headerClasses">
      
      <div class="flex items-center gap-3 flex-1 min-w-0">
        <!-- Puntos decorativos -->
        @if (variant() === 'default') {
          <div class="flex gap-1.5 flex-shrink-0">
            @for (dotClass of styles().dotClasses; track $index) {
              <div class="dot w-3 h-3 rounded-full" [ngClass]="dotClass"></div>
            }
          </div>
        }
        
        <!-- Información -->
        <div class="flex items-center gap-2 min-w-0">
          @if (filename()) {
            <span class="text-sm font-medium truncate">
              {{ filename() }}
            </span>
          }
          
          <!-- Badge del lenguaje -->
          <span class="text-xs px-2 py-0.5 rounded font-medium whitespace-nowrap flex-shrink-0"
                [ngClass]="styles().languageBadgeClasses">
            {{ language().toUpperCase() }}
          </span>
        </div>
      </div>
      
      <!-- Acciones -->
      <div class="flex items-center gap-2 flex-shrink-0">
        <!-- Botón copiar -->
        @if (showCopyButton()) {
          <button (click)="copyToClipboard()"
                  class="flex items-center gap-2 px-3 py-1.5 rounded text-sm font-medium transition-all duration-200 whitespace-nowrap"
                  [ngClass]="styles().copyButtonClasses"
                  [attr.aria-label]="copied() ? 'Código copiado' : 'Copiar código'"
                  [disabled]="copied()">
            @if (copied()) {
              <i-lucide [name]="Check" class="w-4 h-4"></i-lucide>
              <span class="hidden sm:inline">Copiado</span>
            } @else {
              <i-lucide [name]="Copy" class="w-4 h-4"></i-lucide>
              <span class="hidden sm:inline">Copiar</span>
            }
          </button>
        }
      </div>
    </div>
  }
  
  <!-- Contenido del código -->
  <div class="code-content relative">
    <pre class="m-0 p-4 overflow-x-auto text-sm leading-relaxed font-mono whitespace-pre"
        [ngClass]="styles().codeClasses"
        (click)="consoleLogCode()">
      <code class="whitespace-pre block font-mono" [textContent]="code()"></code>
    </pre>
  </div>
  
  <!-- Footer con descripción -->
  @if (description()) {
    <div class="code-footer px-4 py-3 border-t"
         [ngClass]="styles().footerClasses">
      <p class="text-sm m-0"
         [ngClass]="styles().descriptionClasses">
        {{ description() }}
      </p>
    </div>
  }
</div>