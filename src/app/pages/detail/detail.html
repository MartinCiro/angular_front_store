<main class="py-12">
  <div class="flex flex-col lg:flex-row gap-8">

    <!-- Contenido Principal -->
    <div [ngClass]="mainContentClasses()" class="flex-1 min-w-0">
      
      @if (isLoading()) {
        <!-- Loading State -->
        <div class="text-center py-12">
          <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"></div>
          <p class="mt-4 text-gray-600 dark:text-gray-400">Cargando artículo...</p>
        </div>
      } @else if (error()) {
        <!-- Error State -->
        <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6">
          <h2 class="text-xl font-bold text-red-800 dark:text-red-300 mb-2">Error</h2>
          <p class="text-red-700 dark:text-red-400">{{ error() }}</p>
          <button (click)="loadDefaultArticle()" 
                  class="mt-4 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg">
            Cargar artículo por defecto
          </button>
        </div>
      } @else if (article()) {
      <article>
        <!-- Cabecera del artículo - DINÁMICO -->
        <div class="mb-8">
          <h1 class="text-4xl md:text-5xl font-bold text-primary mb-4">
            {{ article()?.title }}
          </h1>
          <div class="flex items-center text-gray-500 dark:text-gray-400 text-sm">
            <img [alt]="'Author ' + article()?.author" 
                 [src]="article()?.authorAvatar" 
                 class="w-8 h-8 rounded-full mr-3" />
            <span>Por {{ article()?.author }}</span>
            <span class="mx-2">|</span>
            <time [attr.datetime]="article()?.publishDate">{{ article()?.publishDate }}</time>
            <span class="mx-2">|</span>
            <span>{{ article()?.readTime }}</span>
            <span class="mx-2">|</span>
            <span>{{ article()?.views }} vistas</span>
          </div>
          
          <!-- Tags -->
          @if (article()?.tags && article()!.tags.length > 0) {
          <div class="flex flex-wrap gap-2 mt-4">
            @for (tag of article()!.tags; track tag) {
            <span class="px-3 py-1 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-full text-sm">
              {{ tag }}
            </span>
            }
          </div>
          }
        </div>

        <!-- Contenido del artículo - DINÁMICO -->
        <div class="prose prose-lg dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 mb-8">
          <p class="text-lg italic text-gray-600 dark:text-gray-400 mb-6">
            {{ article()?.excerpt }}
          </p>
          
          <!-- Contenido HTML del artículo -->
          <div [innerHTML]="article()?.content"></div>
        </div>

        <!-- Ejemplos de código relacionados - DINÁMICO -->
        @if (filteredCodeExamples() && filteredCodeExamples().length > 0) {
        <div class="mb-12">
          <h2 class="text-3xl font-bold text-primary mb-6">Ejemplos de Código Relacionados</h2>

          @for (example of filteredCodeExamples(); track example.id) {
          <div class="mb-8">
            <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200 mb-3">
              {{ example.title }}
            </h3>

            @if (example.description) {
            <p class="text-gray-600 dark:text-gray-400 mb-4">
              {{ example.description }}
            </p>
            }

            <!-- Componente CodeBlock -->
            <app-code-block 
              [code]="example.code"
              [language]="example.language"
              [filename]="example.filename ?? ''"
              [description]="example.description ?? ''">
            </app-code-block>
          </div>
          }
        </div>
        } @else {
        <div class="mb-12">
          <h2 class="text-3xl font-bold text-primary mb-6">Ejemplos de Código</h2>
          <p class="text-gray-500 dark:text-gray-400">
            No hay ejemplos de código disponibles para esta categoría.
          </p>
        </div>
        }
        
      </article>
      } @else {
        <!-- No article found -->
        <div class="text-center py-12">
          <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4">Artículo no encontrado</h2>
          <p class="text-gray-600 dark:text-gray-400 mb-6">El artículo que buscas no está disponible.</p>
          <button (click)="loadDefaultArticle()" 
                  class="px-4 py-2 bg-primary hover:bg-fuchsia-600 text-white rounded-lg">
            Ver artículo por defecto
          </button>
        </div>
      }
    </div>

    <!-- Sidebar -->
    @if (sidebarOpen()) {
    <div class="lg:w-80">
      <app-sidebar 
        [isOpen]="sidebarData().isOpen"
        [relatedPosts]="sidebarData().relatedPosts"
        [popularTopics]="sidebarData().popularTopics"
        [showRelated]="sidebarData().showRelated"
        [showPopular]="sidebarData().showPopular"
        [showCategories]="sidebarData().showCategories"
        [categoriesTitle]="sidebarData().categoriesTitle">
      </app-sidebar>
    </div>
    }

  </div>

  <!-- Botón para toggle sidebar -->
  <div class="fixed bottom-6 right-6">
    <button [ngClass]="buttonClasses()" (click)="toggleSidebar()"
      class="bg-primary hover:bg-fuchsia-600 text-white rounded-full p-3 shadow-lg transition-transform duration-300 transform"
      [attr.aria-label]="sidebarButtonLabel()">
      <mat-icon>{{ buttonIcon() }}</mat-icon>
    </button>
  </div>
</main>