<aside *ngIf="isOpenSignal()"
       class="lg:w-80 lg:flex-shrink-0 transition-all duration-300">
  <div class="space-y-6 sticky top-8">
    
    <!-- Posts Relacionados -->
    @if (shouldShowRelated()) {
      <div class="p-6 rounded-lg shadow-sm border transition-colors duration-200"
           [ngClass]="styles().cardClasses">
        
        <div class="flex items-center gap-2 mb-4">
          <i-lucide [name]="Clock" 
                    class="w-5 h-5" 
                    [ngClass]="styles().iconClasses"></i-lucide>
          <h3 class="text-xl font-bold" 
              [ngClass]="styles().titleClasses">
            Publicaciones Relacionadas
          </h3>
        </div>
        
        <ul class="space-y-4">
          @for (post of limitedRelatedPosts(); track post.id; let i = $index) {
            <li class="group">
              <a [routerLink]="['/blog', post.slug]" 
                 class="block p-3 rounded-lg transition-all duration-200 hover:-translate-y-1"
                 [ngClass]="{
                   'hover:bg-gray-700': isDarkMode(),
                   'hover:bg-gray-100': !isDarkMode()
                 }">
                
                <div class="flex items-start justify-between">
                  <div class="flex-1 min-w-0">
                    <p class="font-semibold truncate mb-1 transition-colors"
                       [ngClass]="{
                         'text-gray-300 group-hover:text-white': isDarkMode(),
                         'text-gray-800 group-hover:text-gray-900': !isDarkMode()
                       }">
                      {{ post.title }}
                    </p>
                    
                    <div class="flex items-center gap-3">
                      <span class="text-sm" 
                            [ngClass]="styles().dateClasses">
                        {{ post.date }}
                      </span>
                      
                      @if (post.category) {
                        <span class="text-xs px-2 py-1 rounded-full"
                              [ngClass]="styles().badgeClasses">
                          {{ post.category }}
                        </span>
                      }
                    </div>
                  </div>
                  
                  <span class="text-xs font-mono text-gray-400 ml-2 flex-shrink-0">
                    #{{ i + 1 }}
                  </span>
                </div>
              </a>
            </li>
          }
        </ul>
        
        @if (relatedPosts().length > 3) {
          <div class="mt-4 pt-4 border-t" 
               [ngClass]="{
                 'border-gray-700': isDarkMode(),
                 'border-gray-200': !isDarkMode()
               }">
            <a href="/blog" 
               class="text-sm font-medium flex items-center justify-center gap-1 transition-colors"
               [ngClass]="styles().textClasses">
              Ver todas las publicaciones
              <i-lucide name="arrow-right" class="w-4 h-4"></i-lucide>
            </a>
          </div>
        }
      </div>
    }
    
    <!-- Temas Populares -->
    @if (shouldShowPopular()) {
      <div class="p-6 rounded-lg shadow-sm border transition-colors duration-200"
           [ngClass]="styles().cardClasses">
        
        <div class="flex items-center gap-2 mb-4">
          <i-lucide [name]="TrendingUp" 
                    class="w-5 h-5" 
                    [ngClass]="styles().iconClasses"></i-lucide>
          <h3 class="text-xl font-bold" 
              [ngClass]="styles().titleClasses">
            Populares Esta Semana
          </h3>
        </div>
        
        <ul class="space-y-3">
          @for (topic of limitedPopularTopics(); track topic; let i = $index) {
            <li class="flex items-center gap-3 group">
              <span class="w-6 h-6 flex items-center justify-center rounded-full text-xs font-bold transition-colors flex-shrink-0"
                    [ngClass]="{
                      'bg-blue-600 text-white': i < 3,
                      'bg-gray-200 text-gray-700 group-hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:group-hover:bg-gray-600': i >= 3
                    }">
                {{ i + 1 }}
              </span>
              
              <a href="#" 
                 class="flex-1 transition-colors truncate hover:underline"
                 [ngClass]="{
                   'text-gray-300 hover:text-white': isDarkMode(),
                   'text-gray-700 hover:text-gray-900': !isDarkMode()
                 }">
                {{ topic }}
              </a>
              
              @if (i < 3) {
                <i-lucide name="trending-up" 
                          class="w-4 h-4 flex-shrink-0"
                          [ngClass]="{
                            'text-green-400': isDarkMode(),
                            'text-green-600': !isDarkMode()
                          }"></i-lucide>
              }
            </li>
          }
        </ul>
      </div>
    }
    
    <!-- CategorÃ­as -->
    @if (showCategoriesSignal()) {  <!-- ðŸš€ Cambio: showCategoriesSignal() -->
      <div class="p-6 rounded-lg shadow-sm border transition-colors duration-200"
           [ngClass]="styles().cardClasses">
        
        <div class="flex items-center gap-2 mb-4">
          <i-lucide [name]="Star" 
                    class="w-5 h-5" 
                    [ngClass]="styles().iconClasses"></i-lucide>
          <h3 class="text-xl font-bold" 
              [ngClass]="styles().titleClasses">
            {{ categoriesTitle() }}
          </h3>
        </div>
        
        <div class="flex flex-wrap gap-2">
          @for (category of [
            'Angular',
            'TypeScript',
            'JavaScript',
            'Web Development',
            'Best Practices',
            'Performance',
            'Testing',
            'Architecture'
          ]; track category) {
            <a [routerLink]="['/category', category.toLowerCase().replace(/\s+/g, '-')]"
               class="inline-block px-3 py-1.5 text-sm rounded-full transition-all duration-200 hover:scale-105"
               [ngClass]="styles().badgeClasses">
              {{ category }}
            </a>
          }
        </div>
      </div>
    }
    
    <!-- Newsletter -->
    <div class="p-6 rounded-lg shadow-sm border transition-colors duration-200"
         [ngClass]="newsletterClasses()">
      
      <div class="text-center">
        <h3 class="text-xl font-bold mb-2"
            [ngClass]="newsletterTitleClasses()">
          ðŸ“¬ SuscrÃ­bete
        </h3>
        
        <p class="text-sm mb-4"
           [ngClass]="newsletterTextClasses()">
          Recibe los Ãºltimos artÃ­culos sobre desarrollo web.
        </p>
        
        <form (ngSubmit)="onSubscribe()" class="space-y-3">
          <input type="email" 
                 placeholder="tu@email.com"
                 required
                 class="w-full px-4 py-2 rounded-lg border transition-colors focus:ring-2 focus:outline-none"
                 [ngClass]="newsletterInputClasses()">
          
          <button type="submit"
                  class="w-full px-4 py-2 bg-primary hover:bg-primary/90 text-white font-medium rounded-lg transition-colors focus:ring-2 focus:ring-primary/50 focus:outline-none">
            Suscribirse
          </button>
        </form>
        
        <p class="text-xs mt-3"
           [ngClass]="newsletterFooterClasses()">
          Sin spam. Puedes darte de baja cuando quieras.
        </p>
      </div>
    </div>
  </div>
</aside>